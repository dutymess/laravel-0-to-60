<!DOCTYPE html>
<html lang="Farsi">
<head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-69680858-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-69680858-2');
</script>

<meta name="msvalidate.01" content="584FCFDB107AA46299F59A2F22EBDF34" />

<title>لاراول، از صفر تا شصت | ورود فله‌ای اطلاعات</title>

<meta charset="utf-8">
<meta name="description" content="راهنمایی گام به گام برای ورود به دنیای لاراول">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="">
<meta property="og:url" content="https://dutymess.github.io/laravel-0-to-60">
<meta property="og:site_name" content="لاراول، از صفر تا شصت">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="">
<meta name="twitter:description" content="">

  <link rel="short icon" href="/static/img/mira.png">
  <link href="/laravel-0-to-60/static/node_modules/bulma-rtl/css/bulma-rtl.css" rel="stylesheet">
  <link href="/laravel-0-to-60/static/zero60/style.css" rel="stylesheet">
  <link href="/laravel-0-to-60/static/zero60/agate.css" rel="stylesheet">
  <link href="https://cdn.rawgit.com/rastikerdar/sahel-font/v1.0.0-alpha13/dist/font-face.css" rel="stylesheet" type="text/css" />

</head>
<body>

  <header class="hero is-info columns">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
              <a href="/laravel-0-to-60">
                لاراول، از صفر تا شصت
              </a>
            </h1>
            <h2 class="subtitle">راهنمایی گام به گام برای ورود به دنیای لاراول</h2>
        </div>
    </div>
    <span class="sidebar_toggle">
        <em class="open-icon"></em>
    </span>
</header>

  <section class="main-content columns is-fullheight">
    <aside id="sidebar" class="column is-one-quarter-desktop is-one-third-tablet section ">
  <div class="sidebar__inner">
    <ul class="menu-list">
        
        <li>
        
        
          <span class="season">پیشگفتار</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson01/preface/">- ماجرای این کتاب</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson02/thanks/">- تشکر می‌کنم</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson03/support/">- حمایت از کتاب</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson04/feedback/">- بازخورد</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter00/lesson05/publish/">- انتشار کتاب</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل اول: پیش به سوی صفر</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter01/lesson01/mvc/">- معماری MVC</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter01/lesson02/composer/">- کامپوزر و مدیریت بسته‌ها</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل دوم: لاراول، در حد صفر</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson01/install/">- نصب و راه اندازی لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson02/folders/">- ساختار پوشه‌های لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter02/lesson03/artisan/">- کنسول آرتیزان</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل سوم: شروع واقعی با دیتابیس</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson01/config/">- پیکربندی‌ها در لاراول</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson02/database/">- پیکربندی دیتابیس</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson03/understanding-migrations/">- درک مفهوم مایگرشن</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson04/migrations/">- طراحی دیتابیس با مایگرشن</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter03/lesson05/apollo-tables/">- جدول‌هایی برای آپولو</a>
            </li>
        
        </ul>
        </li>
        
        <li>
        
        
          <span class="season">فصل چهارم: لایه مدل</span>
          <ul>
        
            <li>
              <a href="/laravel-0-to-60/chapter04/lesson01/model-definition/">- آشنایی با الیکوئنت</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter04/lesson02/simple-queries/">- ایجاد، ویرایش، و حذف رکوردها</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter04/lesson03/mass-assignment/">- ورود فله‌ای اطلاعات</a>
            </li>
        
        
            <li>
              <a href="/laravel-0-to-60/chapter04/lesson04/query-builder/">- کوئری بیلدر</a>
            </li>
        
        </ul>
        </li>
        
    </ul>
  </div>
</aside>

    <div class="container column">
        <div class="section" id="content">

  
      
          <h1 class="list">فصل چهارم: لایه مدل</h1>
      

    <h3 class="list">ورود فله‌ای اطلاعات</h3>

    <div class="content-body content">
    <a name="more"></a>
<p>در درس پیش، آموختیم که چطور مدل‌های خالی الیکوئنت که با دستورات آرتیزان ساخته می‌شوند، به کار می‌آیند. ما متدهای موجود در همین الیکوئنت‌های صفرکیلومتر را برای سه عملکرد اصلی «ساخت رکورد جدید»، «به‌روزرسانی» و «حذف» به کار گرفتیم و نیم‌نگاهی هم به کوئری‌های ساده‌ای همچون شمارش کردن (<code>()count</code>) و یافتن (<code>()find</code>) انداختیم.</p>

<p>در این درس، ساز و کارهای ورود فله‌ای اطلاعات در دیتابیس را خواهیم آموخت و برای این کار ،دیگر الیکوئنت‌های خالی به کارمان نمی‌آیند و باید تغییراتی در آن‌ها داده شود.</p>

<h1>یک رکورد جدید</h1>

<p>به جای این که مثل درس قبل، ستون‌ها را یکی یکی مقداردهی کنیم و سپس ذخیره نماییم، می‌توانیم از متد <code>()create</code> استفاده کنیم و همه چیز را یکباره به لاراول سفارش دهیم.</p>

<h6 id="index.">برای اجرای یک مثال، سراغ همان فایل کنترلر آزمایشی خودمان می‌رویم که در درس قبل ساختیم. متد <code>()index‍</code> فقط متد اصلی را صدا می‌کند تا لازم نباشد متدهای آزمایشی‌ای که ساخته‌ایم و می‌سازیم را هر بار دور بریزیم.</h6>

<pre><code class="language-php">class EloquentTestController extends Controller
{
    public function index()
    {
        return $this-&gt;massCreate();
    }

    private function massCreate()
    {
        $saved_record = Mission::create([
            "code" =&gt; "1234",
            "title" =&gt; "Mass Mission Test",
            "operator" =&gt; "Mass Operator Test",
        ]);

        return $saved_record-&gt;id;
    }
</code></pre>

<p>متد استاتیک <code>()create</code>، آرایه‌ای شامل ستون‌ها و مقدارهای هر یک را می‌گیرد و در دیتابیس ذخیره می‌کند و همان شیء ساخته‌شده از نوع الیکوئنت را به عنوان خروجی بازمی‌گرداند.</p>

<p>فلسفهٔ وجودی این متد آن است که مقدار دریافتی از فرمی که کاربر پر کرده را از یک دست تحویل بگیرد و با دست دیگر در دیتابیس ذخیره کند. </p>

<p>این کار کمی خطرناک به نظر می‌رسد.</p>

<ul>
<li>اولین خطر آن است که انگار داده‌ها بدون اعتبارسنجی سمت سرور روانهٔ دیتابیس شده‌اند. این نگرانی در عمل بیهوده است. لایهٔ اعتبارسنجی ریکوئست در لاراول، میانهٔ راه را می‌گیرد و مطمئن می‌شود که داده‌هایی که به کنترلر می‌رسند از سلامت کامل برخوردارند. </li>
<li>دومین خطر آن است که اگر کاربری جرزنی کند و داده‌ای را که انتظار نداریم همراه با فرم روانهٔ سرور کند، کاری از دست ما ساخته نیست.</li>
</ul>

<p>لاراول، به صورت پیش‌فرض راه را بر خطر دوم نیز بسته است. در واقع چنین کدی اصلاً اجرا نمی‌شود. برای آزمایش، با ریفرش مرورگر خود، قطعه کد بالا را آزمایش کنید و نتیجه را ببینید.</p>

<p><img src="/laravel-0-to-60/images/model-mass-alignment-error.png" alt="Model Mass-alignment Error" id="modelmass-alignmenterror" /></p>

<p>از این خبرها نیست و لاراول نیز چنین اجازه‌ای نمی‌دهد. برای این که بتوانیم داده‌ای را به صورت فله‌ای در دیتابیس ذخیره کنیم، باید از قبل تدارک دیده باشیم و به الیکوئنت گفته باشیم که چه ستون‌هایی می‌توانند به این ترتیب پر شوند.</p>

<p>این همان تغییری است که در مقدمه از آن یاد کردم.</p>

<p>برای این کار، سراغ فایل مدلی که ساخته‌ایم می‌رویم و ستون‌های مجاز را در متغیری به نام <code>fillable$‍‍</code> معرفی می‌کنیم.</p>

<pre><code class="language-php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Mission extends Model
{
    protected $fillable = ['code', 'title', 'operator'];
}
</code></pre>

<p>حالا که چنین کردیم، می‌توانیم مرورگر را ریفرش کنیم و این بار ببینیم که خبری از پیام خطا نیست و اگر سری هم به برنامه‌هایی مثل <code>phpMyAdmin</code> بزنیم، می‌توانیم به رکورد تازه‌ای که به صورت فله‌ای ذخیره کردیم، سلام کنیم.</p>

<p><img src="/laravel-0-to-60/images/model-mass-alignment-success.png" alt="Model Mass-alignment Succcess" id="modelmass-alignmentsucccess" /></p>

<p>ملاحظه می‌فرمایید که این بار نیز ستون‌های <code>created_at‍</code> و <code>updated_at</code> بدون دخالت ما تکمیل شدند.</p>

<h1>لیست سفید / لیست سیاه</h1>

<p>در حالی که متغیر <code>fillable$‍</code> لیست سفیدی از ستون‌هایی که می‌توانند به صورت فله‌ای ذخیره شوند را در خود نگاه می‌دارند، ممکن است این موضوع را در عمل دردسرساز ببینیم و دوست داشته باشیم به جای این کار، لیست سیاهی داشته باشیم از ستون‌هایی که اجازه ندارند به صورت فله‌ای پر شوند.</p>

<p>متغیر <code>guarded$</code> برای همین روزهاست. این متغیر نیز حاوی آرایه‌ای از ستون‌هاست، با این تفاوت که نام ستون‌هایی را نگهداری می‌کند که قرار نیست و اجازه ندارند سفارش‌های فله‌ای بپذیرند.</p>

<pre><code class="language-php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Mission extends Model
{
    protected $guarded = ['is_ratified'];
}
</code></pre>

<p>مدل الیکوئنتی که در قطعه کد بالا تصویر شده، هر ستونی را به صورت فله‌ای می‌پذیرد، به جز ستونی که نشان تصویب شدن مأموریت فضایی را در خود حمل می‌کند.</p>

<p>دانشمندان برنامهٔ فضایی ما نمی‌توانند با دستکاری سادهٔ فرمی که داده‌های یک مأموریت را پر می‌کنند، آن را «تصویب‌شده» جا بزنند و کارشان را جلو بیاندازند.</p>

<p>طبیعتاً منطقی است که بدانیم لازم است انتخاب کنیم. یا لیست سفید را می‌توانیم داشته باشیم و یا لیست سیاه را. </p>

<p>یا متغیر <code>fillable$</code> را پر می‌کنیم و یا <code>guarded$</code> را: </p>

<p>یکی از آن‌ها، نه هر دو.</p>

<h1>به‌روزرسانی فله‌ای</h1>

<p>حالا که می‌توانیم رکوردی را با ارسال فله‌ای داده‌ها ایجاد کنیم، منطقی است که بتوانیم رکوردی موجود را نیز به همین ترتیب آپدیت نماییم.</p>

<pre><code class="language-php">class EloquentTestController extends Controller
{
    public function index()
    {
        return $this-&gt;massUpdate();
    }

    private function massUpdate()
    {
        $saved_record = Mission::find(112)-&gt;update([
            "code" =&gt; "1234" ,
        ]);

        return strval($saved_record);
    }
</code></pre>

<p>این بار هم فقط ستون‌هایی می‌توانند مقدارهای فله‌ای بپذیرند که اگر لیست سفیدی تعریف شده، نامشان در آن وجود داشته باشد و اگر لیست سیاهی تعریف شده، نامشان در آن نباشد.</p>

<p>متد <code>()update</code> بر خلاف متد <code>()create</code> که رکورد ساخته‌شده را بازمی گرداند، مقداری منطقی (true/false) را بازمی‌گرداند که حاکی از موفقیت‌آمیز بودن یا نبودن عمل به‌روزرسانی است.</p>

<p>این ویرایش فله‌ای ممکن است مسخره به نظر برسد، اما به درد زمانی می‌خورد که بخواهیم محتوای یک فرم ویرایش اطلاعات را مستقیماً روانهٔ دیتابیس کنیم. در این صورت احتمالاً <code>id</code> مورد نظر ما نیز همراه با فرم آمده و صد البته که با سطحی از رمزنگاری همراه است، چون قرار نیست اجازه بدهیم یک کاربر کنجکاو با تغییر یک ورودی مخفی، مثل آب خوردن رکوردی که مربوط به او نیست را ویرایش کند.</p>

<h3>ویرایش فله‌ای چند رکورد</h3>

<p>وقتی صحبت از ویرایش اطلاعات در میان باشد، ممکن است لازم باشد که چند رکورد را هم‌زمان تغییر دهیم. آپدیت فله‌ای لاراول، این امکان را مهیا می‌کند.</p>

<pre><code class="language-php">Mission::where('code' , '1234')-&gt;update([
    "code" =&gt; "5678",
]);
</code></pre>

<h1>جان کلام</h1>

<p>در این درس کوتاه، با ورود فله‌ای داده‌ها آشنا شدیم و دانستیم که تنها دو متد الیکوئنت، یکی برای ایجاد و یکی برای به‌روزرسانی، تمام کار ما را راه می‌اندازند. همچنین، دریافتیم که لاراول تنها ستون‌هایی را در فرآیند ورود فله‌ای اطلاعات بازی می‌دهد که یا در لیست سفید معرفی شده باشند و یا در لیست سیاه نباشند.</p>

<p>آخرین قطعه کد این درس، حاوی متدی بود که بی‌توضیح رها شد. این متد و خواهرانش، که «کوئری بیلدر» خوانده می‌شوند، موضوع درس بعدی هستند.</p>

<p>تا آماده شدن درس بعدی که امیدوارم این قدر طول نکشید، با ستاره زدن روی <a href="https://github.com/dutymess/laravel-0-to-60">پروژهٔ این کتاب در گیتهاب</a>، به من انگیزه بدهید، یا با روش‌هایی که در <a href="/laravel-0-to-60/chapter00/lesson04/feedback/">صفحهٔ بازخورد</a> گفته‌ام، ایرادهای نوشته‌ام را نشانم دهید، یا سری به صفحهٔ <a href="/laravel-0-to-60/chapter00/lesson03/support/">حمایت از کتاب</a> بزنید و ببینید که حمایت، همه‌اش پول نیست.</p>

<p>ناگفته پیداست که اگر سؤالی چیزی داشتید هم می‌توانید از طریق راه‌های گفته‌شده در <a href="https://dutymess.github.io/laravel-0-to-60/chapter00/lesson04/feedback/">صفحهٔ بازخورد</a> با من در میان بگذارید.</p>

    </div>
  


</div>

<div class="section">
    <nav class="pagination" role="navigation" aria-label="pagination">
    <a href="/laravel-0-to-60/chapter04/lesson02/simple-queries/" class="pagination-previous button is-primary is-outlined">
    →
    ایجاد، ویرایش، و حذف رکوردها
  </a>




  <a href="/laravel-0-to-60/chapter04/lesson04/query-builder/" class="pagination-next button is-primary is-outlined">
    کوئری بیلدر
    ←
  </a>
    </nav>
</div>
    </div>

  </section>

  <footer class="columns hero section is-dark has-text-centered">
        <div class="container ">
            <div class="columns">

                <div class="column">
                    <div class="footer-header">
                       به این جاها سر بزنید
                    </div>
                    <ul class="related-links has-text-centered">
                        <li>
                            <a href="/laravel-0-to-60/chapter00/lesson03/support/">حمایت از کتاب</a>
                        </li>
                        <li>
                            <a href="/laravel-0-to-60/chapter00/lesson05/publish/">مجوز انتشار</a>
                        </li>
                        <li>
                            <a href="https://github.com/dutymess/laravel-0-to-60/issues" target="_blank">گزارش مشکلات</a>
                        </li>
                        <li>
                          <a href="https://virgool.io/@taha" target="_blank">وبلاگ من در ویرگول</a>
                        </li>
                        <li>
                          <a href="https://blog.dutymess.ir" target="_blank">آن یکی وبلاگ من</a>
                        </li>
                        <li>
                          <a href="https://twitter.com/dutymessIr" target="_blank">و سرانجام، در توییتر</a>
                        </li>
                    </ul>
                </div>
                <div class="column">
                    <div class="footer-header">
                    لاراول از صفر تا شصت
                    </div>
                    <div class="socials">
                      <a href="/laravel-0-to-60">
                        <img class="cover" src="/laravel-0-to-60/images/cover-small.jpg">
                      </a>
                    </div>
                </div>

                <div class="column">
                    <div class="footer-header">
                      از درس‌های جدید آگاه شوید
                    </div>

                    <form action="https://github.us17.list-manage.com/subscribe/post?u=8118b4a1f2130d821eb534012&amp;id=a8b16a6c37" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate is-inline-block" target="_blank" novalidate>

                        <div class="field has-addons">
                            <div class="control">
                                <input name="EMAIL" class="input" type="email" placeholder="عضویت در خبرنامه">
                            </div>
                            <div class="control">
                                <button type="submit" class="button is-info">
                                    عضویت
                                </button>
                            </div>
                        </div>

                        <div id="mce-responses" class="clear">
                          <div class="response" id="mce-error-response" style="display:none"></div>
                          <div class="response" id="mce-success-response" style="display:none"></div>
                        </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    </form>

                    <div class="text">
                      برای ارسال خبرنامه از سرویس
                      mailChimp
                      بهره می‌برم و فقط خبرهای مرتبط با همین کتاب را اطلاع‌رسانی می‌کنم.
                      از نشانی‌ها حتی برای پروژه‌های بعدی و مشابه خودم هم استفاده نمی‌کنم
                      چه برسد به آن که تبلیغ و هرزنامه بفرستم یا
                      خدای ناکرده در اختیار کس دیگری قرار دهم.
                    </div>


                </div>
            </div>
            <div class="has-text-centered credit">
              <div>
              کتاب
              <a href="https://github.com/dutymess/laravel-0-to-60" target="_blank">
              «لاراول، از صفر تا شصت»
              </a>
              با مجوز
              <a href="/laravel-0-to-60/chapter00/lesson05/publish/" >
                کرییتیو کامنز
              </a>
              به صورت رایگان و آزاد منتشر می‌شود و حقوق آن، در چارچوب مجوز یادشده، متعلق به نویسنده
              <a href="https://virgool.io/@taha" target="_blank">
                (طه کامکار)
              </a>
              است.

              </div>
              <div>
                ارائه شده بر بستر
                <a href="https://miraxy.github.io/doc-fa/" target="_blank">میرا</a>
              </div>
            </div>
        </div>
    </footer>


<script type="text/javascript" src="/laravel-0-to-60/static/js/jquery.min.js"></script>
<script src="/laravel-0-to-60/static/js/highlight.pack.js"></script>
<script src="/laravel-0-to-60/static/js/highlightjs-line-numbers.min.js"></script>
<script src="/laravel-0-to-60/static/js/app.js"></script>


</body>
</html>